## 1. 완료된 항목

- [x]  **환경(맵) 구성**
    - 기본 지형, 성벽, 성문 등 기초 환경 배치
    - (테스트용) 지형/경로 간단 배치 완료
- [x]  **NavMesh 적용 및 이동 경로 세팅**
    - 적(AI)이 성문 방향으로 이동 가능
    - `NavMeshAgent` 통해 **일반 병사** AI 이동 구현
- [x]  **플레이어 시야(PlayerLookController)**
    - 마우스/VR 컨트롤러로 시야 이동
    - 상/하/좌/우 회전 제한, 민감도 조절 기능
- [x]  **기본 스크립트 구조 및 이벤트 시스템**
    - `LivingEntity`(체력/피격 관리)
    - `EventManager`(FireStart/Release/Charging/LookChanged 이벤트)
    - `InputManager`(플레이어 입력 처리)
    - 사망, 발사, 시야 회전 등 이벤트 호출 연동
- [x]  **화살 발사/투사체(ArrowShooter, Projectile)**
    - 마우스 혹은 컨트롤러 드래그로 활 당기기
    - 궤적(LineRenderer) 시각화(`ProjectileCurveVisualizer`)
    - 충돌 판정, 투사체 속도/중력 적용
- [x]  **기본 적 AI(Enemy, EnemyData)**
    - `NavMeshAgent`로 목표(성문) 추적
    - 공격 범위 도달 시 성문 공격
    - 피격/사망 처리
- [x]  오브젝트 풀 적용(EnemyPool, ProjectilePool)
	- 풀 사용햘 오브젝트별로 스크립트 생성
	- 유니티 Pool API 사용
- [x] **웨이브 매니저**(WaveManager) (High)
    - 웨이브마다 적 스폰, 난이도 조절, 보스 웨이브 제어 등
    - “웨이브 시작/종료 → 상점 UI 활성화 → 다음 웨이브 준비” 전체 흐름
- [x] **스폰 매니저**(SpawnManager) (High)
    - 적 생성 위치(포탈 또는 깃발 지점)
    - 웨이브 정보에 따라 적 타입/수량 스폰
- [x] **게임 흐름(GameFlowManager / StageManager)** (Medium)
    - 게임 시작/웨이브/보스/승리/패배 일괄 제어
    - 일시정지(Pause), 난이도 스케일링, UI 연동
- [x] **UI 전반** (Medium)
    - HP 바, Wave 진행도, 골드 표시
    - 메뉴/옵션/결과 화면 등
- [x] **방어 타워/트랩 시스템** (High)(진행중)
    - 타워 prefab, 트랩 prefab 구현
    - 공격 로직(주기적으로 적 탐색 → 발사 or 폭발)
    - 업그레이드(사거리, 공격력, 쿨다운 등) 기획 반영
- [x] **상점 UI & 경제(골드)** (High)
    - 적 처치 시 골드 획득, 상점에서 화살/타워 구매
    - Wave 종료 시 상점 활성화 (VR일 경우 레이로 구매)
    - 업그레이드/화살 보충/성문 수리 등 세부 기능

- ## 2. 앞으로 해야 할 작업

아직 구현되지 않았거나 추가로 필요한 기능을 기획서 순서에 따라 나열했습니다. **우선순위**(High/Medium/Low)를 병기했으니 진행 순서에 참고하세요.

### 2.1. 디펜스/웨이브 시스템
1. **유령/정찰/궁수형 적 등** 특수 적 AI (Medium)
    
    - 현재는 일반형 적만 존재
    - 기획서에 나온 “유령형(네비메시 무시)” 등 추가 필요

### 2.2. 방어 타워 및 상점 시스템



1. **NPC 동료 궁수** (Medium)
    - 상점에서 고용 → 성벽 위 배치 & 자동 사격
    - (옵션) AI 혹은 단순 타겟팅 방식

### 2.3. 게임 진행 & UI/UX



1. **사운드 매니저(SoundManager) 확장** (Low)
    - 폭발, 타워 발사, UI 클릭 등 세부 효과음 연동
    - 보스 등장 BGM 전환, 웨이브 경고음

### 2.4. 특수 화살 & 부가 기능

1. **특수 화살** (Medium)
    
    - 폭발 화살, 둔화 화살, 화염 화살 등
    - 스크립트 설계와 상점 구매 로직 연결
11. **보스 구현** (Low)
    
    - 중간 보스(5웨이브), 최종 보스(10웨이브)
    - 고유 스킬(광역 공격, 쫄몹 소환 등), 연출(등장 이펙트)
12. **ML-Agents(유령 AI)** (Low)
    
    - 네비메시 무시 이동 or 인공지능 학습
    - 프로젝트 규모에 따라 추후 검토

---

## 3. 우선순위 요약 (High → Medium → Low)

**High Priority**

1. 웨이브 매니저 & 스폰 매니저
2. 방어 타워 시스템 & 상점(구매/업그레이드)
3. 적 종류(궁수, 빠른 적, 탱커 등) 다양화

**Medium Priority**  
1) NPC 동료 궁수  
2) 게임 흐름 매니저(승패, 일시정지, 밸런스 등)  
3) UI 전반 (HP/Wave/GOLD 표기, 옵션, 결과화면)  
4) 특수 화살(폭발/둔화/화염)

**Low Priority**  
1) 보스전 특수 연출(중간/최종 보스, 부위 파괴 등)  
2) ML-Agents 기반 유령 적 구현  
3) 추가 사운드/이펙트 폴리싱, 음성 인식(“화살 보충!”)

### 메모

- 현재는 **“환경 & NavMesh & 플레이어 시야 & 화살/투사체”** 까지 기초 전투가 가능해진 상태입니다.
- **디펜스 구조(웨이브 & 타워 & 상점)** 를 붙이고, 적 종류를 늘려가면 게임의 전반적인 틀이 완성됩니다.
- 이후에 보스/유령/스페셜 요소를 넣어서 재미와 완성도를 높이면 좋겠습니다.
- 우선순위가 높은 항목부터 차근차근 진행하시면 될 것 같습니다.

> **Tip:**
> 
> - 웨이브 시스템 & 스폰 매니저는 **중심축** 역할이므로 **가장 먼저** 잡으시는 것을 권장합니다.
> - 방어 타워, 상점, 업그레이드는 **서로 연결**되는 기능이라 같이 구현해야 부드럽게 돌아갑니다.
> - 남은 기능(보스 AI, 특수 화살, NPC 동료)은 기초 프레임이 어느 정도 돌아간 후에 붙이는 쪽이 안정적입니다.
>   
>   

# Castle Guardian VR 스크립트 및 시스템 개요

## 1. 프로젝트 개요
- **타이틀:** Castle Guardian + VR  
- **장르:** 디펜스 슈팅 + VR  
- **플랫폼:** PC, Meta Quest 3 (VR)  
- **엔진:** Unity (Meta Quest SDK 활용)  
- **게임 컨셉:** 3D 탑뷰와 1인칭 활쏘기를 결합한 전략적 디펜스 게임

## 2. 주요 시스템 및 스크립트 역할

### 2.1. 투사체 처리 (Projectile)
- **ProjectileCurveVisualizer.cs**
  - 투사체의 포물선 경로를 계산하여 LineRenderer로 시각화
  - 물리 판정(OverlapSphere 등)을 통해 충돌 지점과 궤적 점 계산

### 2.2. 적 AI 및 상태 관리
- **Enemy.cs**
  - Finite State Machine (Idle, Chasing, Attacking, Dead) 형태로 적 행동 제어
  - NavMeshAgent를 활용하여 성문 등 목표를 향해 이동
  - 적의 스탯은 `EnemyData` ScriptableObject를 통해 설정

### 2.3. 입력 및 이벤트 시스템
- **InputManager.cs**
  - Unity Input System을 통해 “Fire”, “Charging”, “Look” 이벤트 처리
  - 각 입력 이벤트 발생 시 `EventManager`에 메시지 송출
- **EventManager.cs**
  - 싱글톤 방식의 중앙 이벤트 매니저
  - 화살 발사, 웨이브 시작/종료, 시야 변경 등 여러 이벤트를 델리게이트로 관리

### 2.4. 피해 처리 인터페이스
- **IDamageable.cs**
  - 모든 피해 대상(적, 성문, 타워 등)에 구현되어 `TakeDamage()` 메서드로 데미지 적용

### 2.5. 웨이브 및 스폰 관리
- **WaveManager.cs**
  - 웨이브 진행 상황을 관리하며 웨이브 시작/종료 이벤트 발생
  - 일정 시간 후 웨이브 종료 확인 시 다음 웨이브 준비
- **SpawnManager.cs**
  - 지정된 위치를 기준으로 NavMeshSamplePosition()을 이용해 적 스폰
  - 웨이브 이벤트에 따라 적을 순차적으로 스폰
  - [[웨이브 시스템 참고 문서]]

### 2.6. 플레이어 시야 및 카메라 제어
- **PlayerLookController.cs**
  - 시야 변경 이벤트에 따른 카메라 회전 처리
  - 상하, 좌우 회전 제한 및 민감도 조절 기능 포함

### 2.7. 그 외 유틸리티
- **SamplePositionExample.cs**
  - NavMesh.SamplePosition() 사용 예제로, 지정 좌표 근처의 유효한 NavMesh 지점 탐색

## 3. 스크립트 간의 연관 관계 및 데이터 흐름
- **이벤트 기반 구조:**
  - InputManager가 입력을 받고 EventManager를 통해 이벤트 송출  
  - Enemy, PlayerLookController, WaveManager 등 다수의 스크립트가 EventManager의 이벤트를 구독하여 독립적으로 기능 실행
- **적 AI와 웨이브 시스템:**
  - WaveManager에서 웨이브가 시작되면 SpawnManager가 적을 생성  
  - Enemy는 NavMeshAgent에 의한 이동 및 상태 전환(추격, 공격 등)을 수행
- **투사체 연동:**
  - ProjectileCurveVisualizer가 투사체의 경로를 계산하고 시각화하여 플레이어 조준 보조 역할 수행
- **통합 피해 처리:**
  - IDamageable 인터페이스를 통해 적, 성문, 타워 등 공통적인 피해 처리를 일원화

## 4. 향후 추가될 기능
- **방어 타워 및 상점 시스템:** 타워 배치, 업그레이드, 화살 보충 등  
- **특수 화살 구현:** 폭발, 둔화, 불 화살 등 다양한 화살 타입 추가  
- **NPC 동료 궁수 및 보스 AI:** 중간/최종 보스, 서브 유닛 소환 등 게임 진행 다양화

---

> **참고:**  
> 이 문서는 기획서에 따른 전체 시스템 아키텍처 및 스크립트 간의 상호 참조 관계를 정리한 것입니다. 향후 개발 진행 상황에 따라 추가/수정될 수 있습니다.


게임 로고 제작![[1.jpg]]
